<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot Availability Selector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }
        .calendar-table {
            border-collapse: separate;
            border-spacing: 0.25rem; /* space between cells */
        }
        .calendar-day {
            transition: all 0.2s ease-in-out;
        }
        .calendar-day.selectable:hover {
            background-color: #334155; /* slate-700 on hover */
        }
        .calendar-day.selected {
            background-color: #059669; /* emerald-600 */
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            border-radius: 9999px;
            box-shadow: 0 0 15px rgba(5, 150, 105, 0.5);
        }
        .calendar-day.past {
            color: #475569; /* slate-600 */
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto bg-slate-800 rounded-2xl shadow-lg p-6 space-y-6 m-4 border border-slate-700">
        <!-- Header Section -->
        <div class="space-y-2">
             <!-- Icon -->
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-semibold text-slate-100 text-center">Pilot Availability</h1>
            <p class="text-center text-slate-400 mt-1">Select your available flight days.</p>
        </div>

        <!-- Calendars Container -->
        <div id="calendars-container" class="space-y-6">
            <!-- Calendars will be dynamically inserted here -->
        </div>

        <!-- Action Button -->
        <button id="submit-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 focus:ring-offset-slate-800">
            Submit
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarsContainer = document.getElementById('calendars-container');
            const submitBtn = document.getElementById('submit-btn');

            // Use a Set for efficient add/delete of selected dates
            const selectedDates = new Set();
            
            // --- Date and Time Configuration ---
            // Use the actual current date for the user.
            const today = new Date();
            // Set time to 0 to ensure whole-day comparisons work correctly
            today.setHours(0, 0, 0, 0); 
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();

            /**
             * Generates and appends a calendar for a given month and year.
             * @param {number} year - The full year (e.g., 2025)
             * @param {number} month - The month, 0-indexed (e.g., 9 for October)
             */
            function createCalendar(year, month) {
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                const daysOfWeek = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];

                const calendarWrapper = document.createElement('div');
                
                // --- Calendar Header ---
                const header = document.createElement('h2');
                header.className = 'text-lg font-semibold text-center text-slate-200';
                header.textContent = `${monthNames[month]} ${year}`;
                calendarWrapper.appendChild(header);

                // --- Calendar Table ---
                const table = document.createElement('table');
                table.className = 'w-full calendar-table mt-2';
                
                // --- Day of Week Headers ---
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                daysOfWeek.forEach(day => {
                    const th = document.createElement('th');
                    th.className = 'text-xs text-slate-400 font-medium';
                    th.textContent = day;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);

                // --- Calendar Body (Days) ---
                const tbody = document.createElement('tbody');
                const firstDay = new Date(year, month, 1).getDay(); // Day of week for the 1st
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                let date = 1;
                for (let i = 0; i < 6; i++) { // Max 6 rows for a month
                    const row = document.createElement('tr');
                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement('td');
                        cell.className = 'calendar-day text-center w-10 h-10 p-1 cursor-pointer rounded-full';

                        if (i === 0 && j < firstDay) {
                            // Empty cells before the 1st day of the month
                            cell.classList.remove('cursor-pointer');
                        } else if (date > daysInMonth) {
                            // Stop after the last day of the month
                            cell.classList.remove('cursor-pointer');
                        } else {
                            // --- Fill in the date ---
                            const currentDate = new Date(year, month, date);
                            cell.textContent = date;
                            
                            // Check if the date is in the past
                            if (currentDate < today) {
                                cell.classList.add('past');
                                cell.classList.remove('cursor-pointer');
                            } else {
                                cell.classList.add('selectable');
                                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                                cell.dataset.date = dateString; // Store date in YYYY-MM-DD format
                            }
                            date++;
                        }
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                    if (date > daysInMonth) break; // Exit loop if all dates are rendered
                }
                table.appendChild(tbody);
                calendarWrapper.appendChild(table);
                calendarsContainer.appendChild(calendarWrapper);
            }

            // --- Event Handling ---
            calendarsContainer.addEventListener('click', function(e) {
                const target = e.target;
                if (target.classList.contains('selectable') && !target.classList.contains('past')) {
                    const date = target.dataset.date;
                    target.classList.toggle('selected');
                    if (selectedDates.has(date)) {
                        selectedDates.delete(date);
                    } else {
                        selectedDates.add(date);
                    }
                }
            });

            submitBtn.addEventListener('click', function() {
                if (selectedDates.size === 0) {
                    // Replaced alert with a more modern, non-blocking notification.
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Please select a date first!';
                    submitBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                    setTimeout(() => {
                        submitBtn.textContent = originalText;
                        submitBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    }, 2000);
                    return;
                }

                // Convert Set to a sorted array
                const availabilityArray = Array.from(selectedDates).sort();

                const jsonData = {
                    "availableDates": availabilityArray
                };

                // Create the mailto link with JSON in the body
                const email = '100ARW.RoyalSpark@us.af.mil';
                const subject = 'Pilot Availability Submission';
                const body = `Pilot availability report:\n\n${JSON.stringify(jsonData, null, 2)}`;
                
                // URL encode the subject and body for the mailto link
                const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;

                // Open the user's default email client
                window.location.href = mailtoLink;
            });

            // --- Initialization ---
            createCalendar(currentYear, currentMonth); // Current month
            createCalendar(currentYear, currentMonth + 1); // Next month
        });
    </script>
</body>
</html>

