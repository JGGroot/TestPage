<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot Availability Selector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }
        .calendar-table {
            border-collapse: separate;
            border-spacing: 0.25rem;
        }
        .calendar-day {
            transition: all 0.2s ease-in-out;
        }
        .calendar-day:focus {
            outline: none;
        }
        .calendar-day.selectable:hover {
            background-color: #334155; /* slate-700 on hover */
        }
        .calendar-day.selected {
            background-color: #059669; /* emerald-600 */
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            border-radius: 9999px;
            box-shadow: 0 0 15px rgba(5, 150, 105, 0.5);
        }
        .calendar-day.unavailable {
            background-color: #dc2626; /* red-600 */
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            border-radius: 9999px;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        .calendar-day.past {
            color: #475569; /* slate-600 */
            pointer-events: none;
        }
        .tab-btn.active {
            background-color: #1e293b; /* slate-800 */
            color: #f1f5f9; /* slate-100 */
        }
        #menu-content {
            transition: transform 0.3s ease-in-out;
        }
        #menu-btn {
            transition: box-shadow 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto bg-slate-800 rounded-2xl shadow-lg p-6 space-y-6 m-4 border border-slate-700">
        
        <!-- This container is for the initial name setup -->
        <div id="setup-container" class="hidden">
             <div class="space-y-2 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
                <h1 class="text-2xl font-semibold text-slate-100">User Setup</h1>
                <p class="text-center text-slate-400 mt-1 pb-4">Please enter your name to link with your submissions.</p>
            </div>
            <div class="space-y-3 pt-2">
                <input type="text" id="name-input" placeholder="Enter your full name (e.g., John Doe)" class="w-full bg-slate-700 border border-slate-600 rounded-md px-3 py-2 text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                <button id="save-name-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-md">Save Name</button>
            </div>
        </div>

        <!-- This container holds the main app functionality -->
        <div id="main-app-container" class="hidden">
            <!-- Header Section -->
            <div class="relative space-y-2">
                <!-- Hamburger Menu -->
                <div class="absolute top-0 right-0">
                    <button id="menu-btn" class="p-2 rounded-full hover:bg-slate-700 focus:outline-none">
                        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
                <div class="text-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-semibold text-slate-100 text-center">Pilot Availability</h1>
                <p class="text-center text-slate-400 mt-1">Select your available or unavailable flight days.</p>
            </div>
            
            <!-- Tabs -->
            <div class="bg-slate-700 rounded-lg p-1 flex space-x-1">
                <button id="available-tab" class="tab-btn w-1/2 p-2 rounded-md text-sm font-medium text-slate-300 transition active">Available</button>
                <button id="unavailable-tab" class="tab-btn w-1/2 p-2 rounded-md text-sm font-medium text-slate-300 transition">Unavailable</button>
            </div>

            <!-- Calendars Container -->
            <div id="calendars-container" class="space-y-6">
                <!-- Calendars will be dynamically inserted here -->
            </div>

            <!-- Action Button -->
            <button id="submit-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 focus:ring-offset-slate-800">
                Submit
            </button>
        </div>
        
        <!-- Menu Modal -->
        <div id="menu-modal" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
        <div id="menu-content" class="fixed top-0 right-0 h-full w-64 bg-slate-800 shadow-lg z-50 p-4 transform translate-x-full">
             <h2 class="text-lg font-semibold text-white mb-4">Menu</h2>
             <button id="change-name-btn" class="w-full text-left py-2 px-3 rounded-md hover:bg-slate-700 text-slate-300">Change Name</button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Main App Containers
            const setupContainer = document.getElementById('setup-container');
            const mainAppContainer = document.getElementById('main-app-container');
            
            // Name Setup Elements
            const nameInput = document.getElementById('name-input');
            const saveNameBtn = document.getElementById('save-name-btn');
            
            // Main App Elements
            const calendarsContainer = document.getElementById('calendars-container');
            const submitBtn = document.getElementById('submit-btn');
            const availableTab = document.getElementById('available-tab');
            const unavailableTab = document.getElementById('unavailable-tab');

            // Menu Elements
            const menuBtn = document.getElementById('menu-btn');
            const menuModal = document.getElementById('menu-modal');
            const menuContent = document.getElementById('menu-content');
            const changeNameBtn = document.getElementById('change-name-btn');

            let activeTab = 'available';
            const selectedDates = new Set();
            const unavailableDates = new Set();
            let pilotName = localStorage.getItem('pilotName') || null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();

            function showMainApp() {
                setupContainer.classList.add('hidden');
                mainAppContainer.classList.remove('hidden');
            }

            function showSetup() {
                mainAppContainer.classList.add('hidden');
                setupContainer.classList.remove('hidden');
            }
            
            function updateMenuUI() {
                if (pilotName) {
                    changeNameBtn.textContent = 'Change Name';
                } else {
                    changeNameBtn.textContent = 'Set Name (Required)';
                }
            }

            saveNameBtn.addEventListener('click', () => {
                const newName = nameInput.value.trim();
                if (newName) {
                    pilotName = newName;
                    localStorage.setItem('pilotName', pilotName);
                    showMainApp();
                    updateMenuUI();
                } else {
                    nameInput.value = '';
                    nameInput.placeholder = "Name cannot be empty!";
                }
            });

            // Menu Logic
            function toggleMenu(visible) {
                if(visible) {
                    menuModal.classList.remove('hidden');
                    menuContent.classList.remove('translate-x-full');
                } else {
                    menuModal.classList.add('hidden');
                    menuContent.classList.add('translate-x-full');
                }
            }
            menuBtn.addEventListener('click', () => toggleMenu(true));
            menuModal.addEventListener('click', () => toggleMenu(false));
            changeNameBtn.addEventListener('click', () => {
                toggleMenu(false);
                showSetup();
            });


            function updateTabStyles() {
                if (activeTab === 'available') {
                    availableTab.classList.add('active');
                    unavailableTab.classList.remove('active');
                } else {
                    unavailableTab.classList.add('active');
                    availableTab.classList.remove('active');
                }
                renderSelections();
            }

            function renderSelections() {
                document.querySelectorAll('.calendar-day.selectable').forEach(cell => {
                    const date = cell.dataset.date;
                    cell.classList.remove('selected', 'unavailable');
                    if (selectedDates.has(date)) {
                        cell.classList.add('selected');
                    }
                    if (unavailableDates.has(date)) {
                        cell.classList.add('unavailable');
                    }
                });
            }

            availableTab.addEventListener('click', () => { activeTab = 'available'; updateTabStyles(); });
            unavailableTab.addEventListener('click', () => { activeTab = 'unavailable'; updateTabStyles(); });

            function createCalendar(year, month) {
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                const daysOfWeek = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
                const calendarWrapper = document.createElement('div');
                const header = document.createElement('h2');
                header.className = 'text-lg font-semibold text-center text-slate-200';
                header.textContent = `${monthNames[month]} ${year}`;
                calendarWrapper.appendChild(header);
                const table = document.createElement('table');
                table.className = 'w-full calendar-table mt-2';
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                daysOfWeek.forEach(day => {
                    const th = document.createElement('th');
                    th.className = 'text-xs text-slate-400 font-medium';
                    th.textContent = day;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);
                const tbody = document.createElement('tbody');
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                let date = 1;
                for (let i = 0; i < 6; i++) {
                    const row = document.createElement('tr');
                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement('td');
                        cell.className = 'calendar-day text-center w-10 h-10 p-1 cursor-pointer rounded-full';
                        if (i === 0 && j < firstDay || date > daysInMonth) {
                            cell.classList.remove('cursor-pointer');
                        } else {
                            const currentDate = new Date(year, month, date);
                            cell.textContent = date;
                            if (currentDate < today) {
                                cell.classList.add('past');
                                cell.classList.remove('cursor-pointer');
                            } else {
                                cell.classList.add('selectable');
                                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                                cell.dataset.date = dateString;
                            }
                            date++;
                        }
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                    if (date > daysInMonth) break;
                }
                table.appendChild(tbody);
                calendarWrapper.appendChild(table);
                calendarsContainer.appendChild(calendarWrapper);
            }

            calendarsContainer.addEventListener('click', function(e) {
                const target = e.target;
                if (target.classList.contains('selectable') && !target.classList.contains('past')) {
                    const date = target.dataset.date;
                    if (activeTab === 'available') {
                        unavailableDates.delete(date);
                        selectedDates.has(date) ? selectedDates.delete(date) : selectedDates.add(date);
                    } else {
                        selectedDates.delete(date);
                        unavailableDates.has(date) ? unavailableDates.delete(date) : unavailableDates.add(date);
                    }
                    renderSelections();
                }
            });

            submitBtn.addEventListener('click', function() {
                if (!pilotName) {
                    // **MODIFIED LOGIC**
                    // Do NOT show the setup screen. Instead, prompt the user to use the menu.
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Set Name in Menu First!';
                    menuBtn.classList.add('ring-2', 'ring-emerald-500', 'shadow-lg');
                    setTimeout(() => { 
                        submitBtn.textContent = originalText;
                        menuBtn.classList.remove('ring-2', 'ring-emerald-500', 'shadow-lg');
                    }, 3000);
                    return;
                }

                if (selectedDates.size === 0 && unavailableDates.size === 0) {
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Please select at least one date!';
                    setTimeout(() => { submitBtn.textContent = originalText; }, 2000);
                    return;
                }

                const jsonData = { pilotName: pilotName };
                if (selectedDates.size > 0) {
                    jsonData.availableDates = Array.from(selectedDates).sort();
                }
                if (unavailableDates.size > 0) {
                    jsonData.unavailableDates = Array.from(unavailableDates).sort();
                }

                const email = '100ARW.RoyalSpark@us.af.mil';
                const subject = `Pilot Availability Submission - ${pilotName}`;
                const body = `Pilot availability and unavailability report:\n\n${JSON.stringify(jsonData, null, 2)}`;
                const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
            });

            // --- Initialization ---
            function initializeApp() {
                showMainApp(); // Always show the main app first.
                updateMenuUI(); // Update menu text based on if name exists.
                
                // Build calendars so they are ready
                createCalendar(currentYear, currentMonth);
                createCalendar(currentYear, currentMonth + 1);
                updateTabStyles();
            }

            initializeApp();
        });
    </script>
</body>
</html>

