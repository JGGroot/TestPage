<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot Availability Selector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .calendar-table {
            border-collapse: separate;
            border-spacing: 0.25rem;
        }
        .calendar-day {
            transition: all 0.2s ease-in-out;
        }
        .calendar-day.selectable:hover {
            background-color: #334155; /* slate-700 on hover */
        }
        .calendar-day.selected {
            background-color: #059669; /* emerald-600 */
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            border-radius: 9999px;
            box-shadow: 0 0 15px rgba(5, 150, 105, 0.5);
        }
        .calendar-day.unavailable {
            background-color: #dc2626; /* red-600 */
            color: white;
            font-weight: 600;
            transform: scale(1.05);
            border-radius: 9999px;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        .calendar-day.past {
            color: #475569; /* slate-600 */
            pointer-events: none;
        }
        .tab-btn.active {
            background-color: #1e293b; /* slate-800 */
            color: #f1f5f9; /* slate-100 */
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto bg-slate-800 rounded-2xl shadow-lg p-6 space-y-6 m-4 border border-slate-700">
        <!-- Header Section -->
        <div class="space-y-2">
             <!-- Icon -->
            <div class="text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 mx-auto text-emerald-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </div>
            <h1 class="text-2xl font-semibold text-slate-100 text-center">Pilot Availability</h1>
            <p class="text-center text-slate-400 mt-1">Select your available or unavailable flight days.</p>
        </div>
        
        <!-- Name Section -->
        <div id="name-section" class="bg-slate-900/50 rounded-lg p-3 text-center border border-slate-700 transition-shadow">
            <div id="name-display">
                <!-- Content generated by JS -->
            </div>
            <div id="name-form" class="hidden space-y-2 pt-2">
                <input type="text" id="name-input" placeholder="Enter your full name (e.g., John Doe)" class="w-full bg-slate-700 border border-slate-600 rounded-md px-3 py-2 text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500">
                <button id="save-name-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-4 rounded-md text-sm">Save Name</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-slate-700 rounded-lg p-1 flex space-x-1">
            <button id="available-tab" class="tab-btn w-1/2 p-2 rounded-md text-sm font-medium text-slate-300 transition active">Available</button>
            <button id="unavailable-tab" class="tab-btn w-1/2 p-2 rounded-md text-sm font-medium text-slate-300 transition">Unavailable</button>
        </div>

        <!-- Calendars Container -->
        <div id="calendars-container" class="space-y-6">
            <!-- Calendars will be dynamically inserted here -->
        </div>

        <!-- Action Button -->
        <button id="submit-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition-all transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 focus:ring-offset-slate-800">
            Submit
        </button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendarsContainer = document.getElementById('calendars-container');
            const submitBtn = document.getElementById('submit-btn');
            const availableTab = document.getElementById('available-tab');
            const unavailableTab = document.getElementById('unavailable-tab');
            const nameSection = document.getElementById('name-section');
            const nameDisplay = document.getElementById('name-display');
            const nameForm = document.getElementById('name-form');
            const nameInput = document.getElementById('name-input');
            const saveNameBtn = document.getElementById('save-name-btn');

            let activeTab = 'available';
            const selectedDates = new Set();
            const unavailableDates = new Set();
            let pilotName = localStorage.getItem('pilotName') || null;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth();

            function updateNameUI() {
                if (pilotName) {
                    nameDisplay.innerHTML = `<p class="text-slate-200">Welcome, <span class="font-semibold text-emerald-400">${pilotName}</span></p><button id="set-name-btn" class="text-slate-400 hover:text-slate-200 text-sm font-medium mt-1 underline">Change Name</button>`;
                } else {
                    nameDisplay.innerHTML = `<p class="text-slate-400">New user. Please set your name.</p><button id="set-name-btn" class="text-emerald-400 hover:text-emerald-300 text-sm font-medium mt-1">Set Name</button>`;
                }
                nameForm.classList.add('hidden');
                nameDisplay.classList.remove('hidden');
                // Re-attach listener as innerHTML removes it
                document.getElementById('set-name-btn').addEventListener('click', toggleNameForm);
            }

            function toggleNameForm() {
                nameDisplay.classList.toggle('hidden');
                nameForm.classList.toggle('hidden');
                if (!nameForm.classList.contains('hidden')) {
                    nameInput.focus();
                }
            }
            
            saveNameBtn.addEventListener('click', () => {
                const newName = nameInput.value.trim();
                if (newName) {
                    pilotName = newName;
                    localStorage.setItem('pilotName', pilotName);
                    updateNameUI();
                } else {
                    nameInput.value = '';
                    nameInput.placeholder = "Name cannot be empty!";
                }
            });

            function updateTabStyles() {
                if (activeTab === 'available') {
                    availableTab.classList.add('active');
                    unavailableTab.classList.remove('active');
                } else {
                    unavailableTab.classList.add('active');
                    availableTab.classList.remove('active');
                }
                renderSelections();
            }

            function renderSelections() {
                document.querySelectorAll('.calendar-day.selectable').forEach(cell => {
                    const date = cell.dataset.date;
                    cell.classList.remove('selected', 'unavailable');
                    if (selectedDates.has(date)) {
                        cell.classList.add('selected');
                    }
                    if (unavailableDates.has(date)) {
                        cell.classList.add('unavailable');
                    }
                });
            }

            availableTab.addEventListener('click', () => { activeTab = 'available'; updateTabStyles(); });
            unavailableTab.addEventListener('click', () => { activeTab = 'unavailable'; updateTabStyles(); });

            function createCalendar(year, month) {
                const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                const daysOfWeek = ["Su", "Mo", "Tu", "We", "Th", "Fr", "Sa"];
                const calendarWrapper = document.createElement('div');
                const header = document.createElement('h2');
                header.className = 'text-lg font-semibold text-center text-slate-200';
                header.textContent = `${monthNames[month]} ${year}`;
                calendarWrapper.appendChild(header);
                const table = document.createElement('table');
                table.className = 'w-full calendar-table mt-2';
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                daysOfWeek.forEach(day => {
                    const th = document.createElement('th');
                    th.className = 'text-xs text-slate-400 font-medium';
                    th.textContent = day;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);
                const tbody = document.createElement('tbody');
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                let date = 1;
                for (let i = 0; i < 6; i++) {
                    const row = document.createElement('tr');
                    for (let j = 0; j < 7; j++) {
                        const cell = document.createElement('td');
                        cell.className = 'calendar-day text-center w-10 h-10 p-1 cursor-pointer rounded-full';
                        if (i === 0 && j < firstDay || date > daysInMonth) {
                            cell.classList.remove('cursor-pointer');
                        } else {
                            const currentDate = new Date(year, month, date);
                            cell.textContent = date;
                            if (currentDate < today) {
                                cell.classList.add('past');
                                cell.classList.remove('cursor-pointer');
                            } else {
                                cell.classList.add('selectable');
                                const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`;
                                cell.dataset.date = dateString;
                            }
                            date++;
                        }
                        row.appendChild(cell);
                    }
                    tbody.appendChild(row);
                    if (date > daysInMonth) break;
                }
                table.appendChild(tbody);
                calendarWrapper.appendChild(table);
                calendarsContainer.appendChild(calendarWrapper);
            }

            calendarsContainer.addEventListener('click', function(e) {
                const target = e.target;
                if (target.classList.contains('selectable') && !target.classList.contains('past')) {
                    const date = target.dataset.date;
                    if (activeTab === 'available') {
                        unavailableDates.delete(date);
                        selectedDates.has(date) ? selectedDates.delete(date) : selectedDates.add(date);
                    } else {
                        selectedDates.delete(date);
                        unavailableDates.has(date) ? unavailableDates.delete(date) : unavailableDates.add(date);
                    }
                    renderSelections();
                }
            });

            submitBtn.addEventListener('click', function() {
                if (!pilotName) {
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Please set your name first!';
                    nameSection.classList.add('ring-2', 'ring-red-500');
                    setTimeout(() => {
                        submitBtn.textContent = originalText;
                        nameSection.classList.remove('ring-2', 'ring-red-500');
                    }, 2500);
                    return;
                }

                const datesToSubmit = activeTab === 'available' ? selectedDates : unavailableDates;
                const subjectType = activeTab === 'available' ? 'Availability' : 'Unavailability';
                const jsonKey = activeTab === 'available' ? 'availableDates' : 'unavailableDates';

                if (datesToSubmit.size === 0) {
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Please select a date first!';
                    setTimeout(() => { submitBtn.textContent = originalText; }, 2000);
                    return;
                }

                const submissionArray = Array.from(datesToSubmit).sort();
                const jsonData = { pilotName: pilotName, [jsonKey]: submissionArray };
                const email = '100ARW.RoyalSpark@us.af.mil';
                const subject = `Pilot ${subjectType} Submission - ${pilotName}`;
                const body = `Pilot ${subjectType} report:\n\n${JSON.stringify(jsonData, null, 2)}`;
                const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
            });

            // --- Initialization ---
            updateNameUI();
            createCalendar(currentYear, currentMonth);
            createCalendar(currentYear, currentMonth + 1);
            updateTabStyles();
        });
    </script>
</body>
</html>

